
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../tutorial_graph/">
      
      
        <link rel="next" href="../tutorial_opencypher_gen/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.3">
    
    
      
        <title>Tutorial vector search - AIGraph4pg</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d7758b05.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial-vector-search" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AIGraph4pg" class="md-header__button md-logo" aria-label="AIGraph4pg" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AIGraph4pg
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial vector search
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cjoakim/AIGraph4pg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AIGraph4pg" class="md-nav__button md-logo" aria-label="AIGraph4pg" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AIGraph4pg
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cjoakim/AIGraph4pg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.0 Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pg_local_installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.0 AIGraph4pg : Local PostgreSQL Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quick_start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.0 AIGraph4pg - Quick Start Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pg_extensions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.0 AIGraph4pg - Configuring and Using PostgreSQL Extensions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_pg_admin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial pg admin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_relational/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial relational
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_graph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial graph
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Tutorial vector search
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Tutorial vector search
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tutorial-vector-search" class="md-nav__link">
    <span class="md-ellipsis">
      Tutorial : Vector Search
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tutorial : Vector Search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-coming-soon-advanced-vector-search-with-diskann-and-semantic-ranking" class="md-nav__link">
    <span class="md-ellipsis">
      9.1 Coming Soon: Advanced Vector Search with DiskANN and Semantic Ranking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-vector-search-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      9.2 Vector Search Concepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-vector-search-implementation-in-this-reference-application-with-pg_vector" class="md-nav__link">
    <span class="md-ellipsis">
      9.3 Vector Search Implementation in this Reference Application with pg_vector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial_opencypher_gen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial opencypher gen
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../psql_commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AIGraph4pg : Common psql Commands
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AIGraph4pg - Frequently Asked Questions (FAQ)
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Tutorial vector search</h1>

<h3 id="tutorial-vector-search">Tutorial : Vector Search</h3>
<h4 id="91-coming-soon-advanced-vector-search-with-diskann-and-semantic-ranking">9.1 Coming Soon: Advanced Vector Search with DiskANN and Semantic Ranking</h4>
<p>This reference application does not yet implement vector search with DiskANN,
and augmented with Semantic Ranking. This functionality is expected to be
added to this project in January/February 2025.<a href="https://www.microsoft.com/en-us/research/project/project-akupara-approximate-nearest-neighbor-search-for-large-scale-semantic-search/">DiskANN</a> is a set of advanced algorithms for vector search and semantic ranking developed by
Microsoft Research. It enables high-scalability, high-performance as well as lower costs.DiskANN is being integrated into several Microsoft products.
It is currently available in preview mode for
<a href="https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/how-to-use-pgdiskann">Azure Database for PostgreSQL - Flexible Server</a>.<a href="https://techcommunity.microsoft.com/blog/adforpostgresql/introducing-the-semantic-ranking-solution-for-azure-database-for-postgresql/4298781">Semantic Ranking</a> functionality is also being integrated into Azure Database for PostgreSQL.
It can be used to improve vector search result quality by using semantic ranking models
to rerank vector search results.</p>
<hr />
<h4 id="92-vector-search-concepts">9.2 Vector Search Concepts</h4>
<p><a href="https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/how-to-use-pgvector#concepts">Vector Search</a> is the functionality in modern databases to search by the
<strong>semantic meaning</strong> of data rather than just precice or fuzzy value matching.
Vector search is typically used in Generative AI applications, where RAG data
is passed to a Large Language Model (LLM) to augment the knowledge base of the model.
Vector search is used to identify this RAG data to be passed to the LLM.Vector search works by first <strong>"vectorizing"</strong> your text data, such as a
product description or summary or a legal case. To create a vector, you invoke an
optimized model in the LLM and pass in your text data to be vectorized. The LLM responds
with a vector of floating-point values of n-dimensions that represents the semantic meaning
of your text data. A vector is alternatively called an <strong>embedding</strong>.You then populate this vector data in your database, and index it with a vector index
so as to make it searchable.To query your database using vector search, you pass in a vector of floating-point values
as a search parameter. You will often have to generate this vector at runtime, by calling
the same LLM text embedding model, given the user natural language query.
Some databases, including Azure Database for PostgreSQL, support
<strong>filtered vector search</strong>, meaning a search that uses both traditonal
WHERE clause logic as well as vector search logic.</p>
<hr />
<h4 id="93-vector-search-implementation-in-this-reference-application-with-pg_vector">9.3 Vector Search Implementation in this Reference Application with pg_vector</h4>
<p>This initial implementation of this reference application uses the
<a href="https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/how-to-use-pgvector#vector-operators">pgvector</a> open-source PostgreSQL extension. Please visit this linked page as it provides
excellent documentation and examples.As described in the
<a href="https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/how-to-use-pgvector#vector-operators">Quick Start</a> documentation in this repo, you have to first enable this extension
in your Azure Database for PostgreSQL server.You'll need a database table with a column of type <strong>vector</strong> to store your
vectors/embeddings. The DDL for the legal_cases table in this project is shown below.
Note the presence of the <strong>embedding</strong> column of type <strong>vector(1536)</strong>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>CREATE TABLE legal_cases (
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  id                   bigserial primary key,
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  name                 VARCHAR(1024),
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>  name_abbreviation    VARCHAR(1024),
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  case_url             VARCHAR(1024),
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>  decision_date        DATE,
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>  court_name           VARCHAR(1024),
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>  citation_count       INTEGER,
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>  text_data            TEXT,
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>  json_data            JSONB,
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>  embedding            vector(1536)      
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>);
</code></pre></div>
This vector(1536) column is populated with embeddings produced by the Azure OpenAI
<a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models?tabs=global-standard%2Cstandard-chat-completions#embeddings">text-embedding-ada-002</a> model. This model produces 1536-dimensional embeddings,
meaning it returns an array of 1536 floating-point values.
Therefore, the corresponding PostgreSQL column type is <strong>vector(1536)</strong>.To enable the vector column to be queried efficiently, you need to create an
<a href="https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/how-to-optimize-performance-pgvector#indexing">index</a> for the column. There are three supported index types:</p>
<ul>
<li>Inverted File with Flat Compression (IVVFlat)</li>
<li>Hierarchical Navigable Small Worlds (HNSW)</li>
<li>Disk Approximate Nearest Neighbor (DiskANN)</li>
</ul>
<p>This reference application uses the <strong>IVFFlat</strong> index type.
The DDL for this index in the legal_cases table is shown below:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>DROP INDEX IF EXISTS idx_legal_cases_ivfflat_embedding;
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>CREATE INDEX idx_legal_cases_ivfflat_embedding
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>ON     legal_cases
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>USING  ivfflat (embedding vector_cosine_ops)
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>WITH  (lists = 50);
</code></pre></div>
Once the data is populated and the column indexed, you can now execute
a vector search vs that column with the <strong>"embedding &lt;-&gt;"</strong> SQL syntax.
Please see the web application code in this repository, file python/webapp.py,
where the vector search SQL is created in method "legal_cases_vector_search_sql()"
as shown below:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>def legal_cases_vector_search_sql(embeddings, limit=10):
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    return (
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>        &quot;&quot;&quot;
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>select id, name_abbreviation, to_char(decision_date, &#39;YYYY-MM-DD&#39;)
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a> from legal_cases
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a> order by embedding &lt;-&gt; &#39;{}&#39;
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a> offset 0 limit 10;
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    &quot;&quot;&quot;.format(
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>            embeddings
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        )
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>        .replace(&quot;\n&quot;, &quot; &quot;)
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>        .strip()
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    )
</code></pre></div>
This query returns the legal case name abbreviation and the date of
the legal case decision for the 10 legal cases that are most similar
to the given embedding value. This is very powerful search functionality.
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>
</code></pre></div></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        &#169; Microsoft 2025
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>